# Acceptance Thresholds for Isaac Sim Demo Validation
# 
# This file defines pass/fail criteria for validating RoboCache against
# the PyTorch CPU baseline. All tests must pass these thresholds.

latency:
  # End-to-end training step latency
  max_ms: 20.0                     # Must be < 20ms/step (real-time requirement)
  baseline_comparison:
    min_speedup: 1.3                # Must be â‰¥ 1.3x faster than baseline
    h100_target_ms: 14.0            # Target: ~14ms on H100
    a100_target_ms: 18.3            # Target: ~18ms on A100

preprocessing:
  # RoboCache preprocessing overhead
  max_percent_of_total: 15.0       # Preprocessing should be < 15% of total time
  target_percent: 10.7             # Target: ~10.7% (validated on H100)

accuracy:
  # Numerical precision (BF16 vs FP32)
  max_l2_error: 1.0e-3             # L2 norm of difference
  max_abs_error: 1.0e-2            # Maximum absolute error (any element)
  max_relative_error: 0.001        # 0.1% relative error
  
  # Gradient flow
  gradient_correlation: 0.99       # Pearson correlation with baseline gradients
  gradient_magnitude_ratio:
    min: 0.95                      # Gradient magnitudes within 5%
    max: 1.05

convergence:
  # Training convergence behavior
  loss_trajectory_match: 0.95      # Correlation of loss curves
  final_loss_difference: 0.05      # Absolute difference in final loss
  
  # Policy quality (if evaluating)
  min_success_rate: 0.80           # Task success rate (if applicable)

throughput:
  # Processing throughput
  min_episodes_per_sec:
    h100: 2000                     # Target: 2279 eps/s on H100
    a100: 1500                     # Target: 1751 eps/s on A100

memory:
  # GPU memory usage
  max_memory_overhead_gb: 2.0      # RoboCache should add < 2GB overhead
  max_memory_fragmentation: 0.10   # < 10% fragmentation

stability:
  # Long-running stability
  max_variance_across_runs: 0.05   # < 5% variance across repeated runs
  no_memory_leaks: true            # Memory must not grow over time
  no_cuda_errors: true             # Zero CUDA runtime errors

modes:
  # Both modes must pass
  baseline:
    enabled: true
    description: "PyTorch CPU reference (slow but accurate)"
  robocache:
    enabled: true
    description: "RoboCache GPU-accelerated (fast)"
    min_speedup_vs_baseline: 1.3

validation_protocol:
  warmup_steps: 10                 # Warmup before measurement
  measurement_steps: 100           # Number of steps to measure
  num_seeds: 5                     # Number of random seeds
  statistical_test: "t-test"       # Use t-test for significance
  p_value_threshold: 0.05          # 95% confidence

# Notes:
# - Thresholds based on validated H100/A100 performance (Nov 2025)
# - BF16 precision: 1e-3 L2 error is expected and acceptable
# - Speedup target (1.3x) is conservative (actual: 1.85x on H100)
# - Memory overhead accounts for temporary buffers in preprocessing

# How to use:
#   python validate_against_golden.py --thresholds acceptance_thresholds.yaml

